The collision constraint between two particles $ \mathbf{x}_{i} $ and $
\mathbf{x}_{j} $ is formulated by Equation \ref{eq:collisionConstraint}, where
$ r $ is the radius of the particles and $ \mathbf{x_{ij}} = \mathbf{x_{i}} - \mathbf{x_{j}} $.

\begin{equation} \label{eq:collisionConstraint}
  C(\mathbf{x}_{i}, \mathbf{x}_{j}) = \| \mathbf{x}_{ij} \| - r \geq 0
\end{equation}

The gradient of the collision constraint with respect to each particle is the
normalized collision vector as defined in Equation~\ref{eq:collisiongradient}.

\begin{equation}
\label{eq:collisiongradient}
\begin{aligned}
\nabla_{\mathbf{x_{i}}} C(\mathbf{x_{i}}, \mathbf{x_{j}})) = \mathbf{n} = \frac{\mathbf{x_{ij}}}{\left | \mathbf{x_{ij}} \right |}
\\
\nabla_{\mathbf{x_{j}}} C(\mathbf{x_{i}}, \mathbf{x_{j}})) = - \mathbf{n} = - \frac{\mathbf{x_{ij}}}{\left | \mathbf{x_{ij}} \right |}
\end{aligned}
\end{equation}

By substituting Equation~\ref{eq:collisionConstraint} and
Equation~\ref{eq:collisiongradient} into Equation~\ref{eq:lambdaallparticles} we
can derive Equation~\ref{eq:lambdacollision}.

\begin{equation}
\label{eq:lambdacollision}
\lambda_{i} = \lambda_{j} = \frac{\left | \mathbf{x_{ij}} \right | - r}{w_{i} + w_{j}}
\end{equation}

In order to calculate the two correction vectors, $ \Delta \mathbf{x_{i}} $ and
$ \Delta \mathbf{x_{j}} $, for the position of each particle we insert
Equation~\ref{eq:lambdacollision} and Equation~\ref{eq:collisiongradient} into
Equation~\ref{eq:deltaX} arrive at the result in Equation~\ref{eq:collisionresult}.

\begin{equation}
\label{eq:collisionresult}
\begin{aligned}
\Delta \mathbf{x_{i}} = \frac{w_{i}}{w_{i} + w_{j}}(\left | \mathbf{x_{ij}} \right | - r) \frac{\mathbf{x_{ij}}}{\left | \mathbf{x_{ij}} \right |}
\\
\Delta \mathbf{x_{j}} = -\frac{w_{j}}{w_{i} + w_{j}}(\left | \mathbf{x_{ij}} \right | - r) \frac{\mathbf{x_{ij}}}{\left | \mathbf{x_{ij}} \right |}
\end{aligned}
\end{equation}
